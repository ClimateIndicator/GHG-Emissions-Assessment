data_ceds_ch4 <- data_ceds_ch4 %>%
group_by(year) %>%
summarise(value=sum(value,na.rm=TRUE)/1000) %>%
mutate(units="MtCH4") %>%
mutate(source="CEDS v2021.4.21") %>%
mutate(var="ch4")
# CEDS CO2 (https://zenodo.org/record/4741285)
data_ceds_co2_ffi <- read.csv("sources/CEDS/CO2_CEDS_emissions_by_country_2021_04_21.csv")
data_ceds_co2_ffi <- gather(data_ceds_co2_ffi,year,value,X1750:X2019)
data_ceds_co2_ffi$year <- gsub("X","",data_ceds_co2_ffi$year)
data_ceds_co2_ffi <- data_ceds_co2_ffi %>%
select(iso=country,gas=em,year,value)
data_ceds_co2_ffi <- data_ceds_co2_ffi %>%
group_by(year) %>%
summarise(value=sum(value,na.rm=TRUE)/1e6) %>%
mutate(units="GtCO2") %>%
mutate(source="CEDS v2021.4.21") %>%
mutate(var="co2_ffi")
# CEDS N2O (https://zenodo.org/record/4741285)
data_ceds_n2o <- read.csv("sources/CEDS/N2O_CEDS_emissions_by_country_2021_04_21.csv")
data_ceds_n2o <- gather(data_ceds_n2o,year,value,X1970:X2019)
data_ceds_n2o$year <- gsub("X","",data_ceds_n2o$year)
data_ceds_n2o <- data_ceds_n2o %>%
select(iso=country,gas=em,year,value)
data_ceds_n2o <- data_ceds_n2o %>%
group_by(year) %>%
summarise(value=sum(value,na.rm=TRUE)/1000) %>%
mutate(units="MtN2O") %>%
mutate(source="CEDS v2021.4.21") %>%
mutate(var="n2o")
# PRIMAP (https://zenodo.org/records/10705513)
data_primap <- read.csv("sources/PRIMAP/Guetschow_et_al_2024-PRIMAP-hist_v2.5.1_final_27-Feb-2024.csv")
data_primap <- gather(data_primap,year,value,X1750:X2022)
data_primap$year <- gsub("X","",data_primap$year)
names(data_primap) <- c("source","scenario","provenance","area","gas","unit","category","year","value")
data_primap <- data_primap %>%
filter(category=="M.0.EL") %>%
filter(area=="EARTH")
data_primap_cr_n2o <- data_primap %>%
filter(scenario=="HISTCR") %>%
filter(gas=="N2O") %>%
group_by(year) %>%
summarise(value=sum(value,na.rm = TRUE)/1000) %>%
mutate(units="MtN2O") %>%
mutate(source="PRIMAP CR v2.5.1*") %>%
mutate(var="n2o")
data_primap_cr_ch4 <- data_primap %>%
filter(scenario=="HISTCR") %>%
filter(gas=="CH4") %>%
group_by(year) %>%
summarise(value=sum(value,na.rm = TRUE)/1000) %>%
mutate(units="MtCH4") %>%
mutate(source="PRIMAP CR v2.5.1*") %>%
mutate(var="ch4")
data_primap_cr_co2_ffi <- data_primap %>%
filter(scenario=="HISTCR") %>%
filter(gas=="CO2") %>%
group_by(year) %>%
summarise(value=sum(value,na.rm = TRUE)/1e6) %>%
mutate(units="GtCO2") %>%
mutate(source="PRIMAP CR v2.5.1") %>%
mutate(var="co2_ffi")
# PRIMAP (TP)
data_primap_tp_n2o <- data_primap %>%
filter(scenario=="HISTTP") %>%
filter(gas=="N2O") %>%
group_by(year) %>%
summarise(value=sum(value,na.rm = TRUE)/1000) %>%
mutate(units="MtN2O") %>%
mutate(source="PRIMAP TP v2.5.1") %>%
mutate(var="n2o")
data_primap_tp_ch4 <- data_primap %>%
filter(scenario=="HISTTP") %>%
filter(gas=="CH4") %>%
group_by(year) %>%
summarise(value=sum(value,na.rm = TRUE)/1000) %>%
mutate(units="MtCH4") %>%
mutate(source="PRIMAP TP v2.5.1") %>%
mutate(var="ch4")
data_primap_tp_co2_ffi <- data_primap %>%
filter(scenario=="HISTTP") %>%
filter(gas=="CO2") %>%
group_by(year) %>%
summarise(value=sum(value,na.rm = TRUE)/1e6) %>%
mutate(units="GtCO2") %>%
mutate(source="PRIMAP TP v2.5.1") %>%
mutate(var="co2_ffi")
## F-gas emissions (from Chris Smith's compiled data)
data_fgases <- read.csv("sources/smith-hall-inversions-1750-2023.csv")
list_fgases <- data_fgases$Variable[14:51]
data_fgases <- gather(data_fgases,year,value,X1750:X2023)
data_fgases$year <- gsub("X","",data_fgases$year)
data_fgases <- data_fgases %>%
mutate(gas=Variable) %>%
select(var=Variable,gas,units=Unit,year,value) %>%
filter(var %in% c(list_fgases))
data_fgases$gas <- gsub("Emissions","",data_fgases$gas)
data_fgases$gas <- gsub("\\|","",data_fgases$gas)
data_fgases$gas <- gsub("-","",data_fgases$gas)
#join GWPs from openclimatedata
gwps <- read.csv("https://raw.githubusercontent.com/openclimatedata/globalwarmingpotentials/main/globalwarmingpotentials.csv",skip = 9)
data_fgases <- left_join(data_fgases,gwps %>% select(gas=Species,AR6GWP100))
data_fgases <- data_fgases %>%
mutate(value=value*AR6GWP100)
list_fgases <- data.frame(var=list_fgases)
list_fgases <- list_fgases %>%
mutate(group=ifelse(grepl("CFC",var),"ODS F-gases",NA)) %>%
mutate(group=ifelse(grepl("HCFC",var),"ODS F-gases",group)) %>%
mutate(group=ifelse(grepl("HFC",var),"UNFCCC F-gases",group)) %>%
mutate(group=ifelse(grepl("Halon",var),"ODS F-gases",group)) %>%
mutate(group=ifelse(grepl("NF3",var),"UNFCCC F-gases",group)) %>%
mutate(group=ifelse(grepl("SF6",var),"UNFCCC F-gases",group)) %>%
mutate(group=ifelse(is.na(group),"UNFCCC F-gases",group))
data_fgases <- left_join(data_fgases,list_fgases,by="var")
data_fgases <- data_fgases %>%
group_by(year,group) %>%
summarise(value=sum(value,na.rm=TRUE)/1e6) %>%
mutate(source=ifelse(group=="ODS F-gases",paste0(group,"\n CIP v2024.04"),paste0(group,"\n CIP v2024.04*"))) %>%
mutate(var="fgases") %>%
mutate(units="GtCO2e") %>%
select(-group)
## GFED data
data_gfed_ch4 <- read.xlsx("sources/GFED/GFED4.1s_2024.xlsx",sheet="GFED_CH4",rows = c(14,29))
data_gfed_ch4 <- gather(data_gfed_ch4,year,value,`1997`:`2023`)
data_gfed_ch4 <- data_gfed_ch4 %>%
mutate(var="ch4") %>%
select(year,var,value) %>%
mutate(value=value*1E10) %>% #1e10 grams to grams
mutate(value=value/1e6) %>%
mutate(value=value/1e6) %>%
mutate(source="GFED v4.1*") %>%
mutate(units="MtCH4") %>%
select(year,value,source,var,units)
data_gfed_n2o <- read.xlsx("sources/GFED/GFED4.1s_2024.xlsx",sheet="GFED_N2O",rows = c(14,29))
data_gfed_n2o <- gather(data_gfed_n2o,year,value,`1997`:`2023`)
data_gfed_n2o <- data_gfed_n2o %>%
mutate(var="n2o") %>%
mutate(value=value*1E9) %>% #1e9 grams to grams
mutate(value=value/1e6) %>%
mutate(value=value/1e6) %>%
mutate(source="GFED v4.1*") %>%
mutate(units="MtN2O") %>%
select(year,value,source,var,units)
## join datasets together
data <- rbind(data_gcb_co2_ffi,data_edgar_co2_ffi)
data <- rbind(data,data_gcb_co2_luc)
data <- rbind(data,data_edgar_ch4)
data <- rbind(data,data_edgar_n2o)
data <- rbind(data,data_ceds_co2_ffi)
data <- rbind(data,data_ceds_ch4)
data <- rbind(data,data_ceds_n2o)
data <- rbind(data,data_primap_cr_co2_ffi)
data <- rbind(data,data_primap_cr_ch4)
data <- rbind(data,data_primap_cr_n2o)
data <- rbind(data,data_primap_tp_co2_ffi)
data <- rbind(data,data_primap_tp_ch4)
data <- rbind(data,data_primap_tp_n2o)
data <- rbind(data,data_fgases)
data <- rbind(data,data_gfed_ch4)
data <- rbind(data,data_gfed_n2o)
data <- data %>%
mutate(year=as.numeric(year)) %>%
mutate(source=as.factor(source))
## prepare a consistent set of labels
data_labels <- spread(data %>% filter(year>2000),year,value)
data_labels <- t(apply(data_labels, 1, zoo::na.locf))
data_labels <- data.frame(data_labels)
data_labels <- gather(data.frame(data_labels),year,value,`X2001`:`X2021`)
data_labels <- data_labels %>%
filter(year=="X2021") %>%
mutate(year=2022) %>%
mutate(value=as.numeric(value)) %>%
mutate(source=as.factor(source))
# data_labels$source <- fct_relevel(data_labels$source,"DGVM mean",after=Inf)
# data$source <- fct_relevel(data$source,"DGVM mean",after=Inf)
## custom color palette for labels and lines
colors = colorRampPalette(brewer.pal(8, "Set2"))(length(unique(data_labels$source)))
#colors <- c(sample(colors[1:10]),colors[11])
data_ghg <- rbind(data_gcb_co2_ffi,data_gcb_co2_luc)
data_ghg <- rbind(data_ghg,data_gfed_ch4)
data_ghg <- rbind(data_ghg,data_gfed_n2o)
data_ghg <- rbind(data_ghg,data_fgases)
data_ghg <- rbind(data_ghg,data_primap_cr_ch4)
data_ghg <- rbind(data_ghg,data_primap_cr_n2o)
data_ghg <- data_ghg %>%
filter(source!="H&C") %>%
filter(source!="OSCAR") %>%
filter(source!="BLUE")
data_ghg <- data_ghg %>%
mutate(gwp=ifelse(var=="ch4",gwps$AR6GWP100[gwps$Species=="CH4"],1)) %>%
mutate(gwp=ifelse(var=="n2o",gwps$AR6GWP100[gwps$Species=="N2O"],gwp)) %>%
mutate(value=value*gwp) %>%
mutate(value=ifelse(var %in% c("ch4","n2o"),value/1000,value))
blarg <- data_ghg %>% filter(year==2020)
View(blarg)
data_ghg <- rbind(data_gcb_co2_ffi,data_gcb_co2_luc)
data_ghg <- rbind(data_ghg,data_gfed_ch4)
data_ghg <- rbind(data_ghg,data_gfed_n2o)
data_ghg <- rbind(data_ghg,data_fgases)
data_ghg <- rbind(data_ghg,data_primap_cr_ch4)
data_ghg <- rbind(data_ghg,data_primap_cr_n2o)
data_ghg <- data_ghg %>%
filter(source!="H&C") %>%
filter(source!="OSCAR") %>%
filter(source!="BLUE")
## Convert CH4 and N2O to CO2e and fix units
data_ghg <- data_ghg %>%
mutate(gwp=ifelse(var=="ch4",gwps$AR6GWP100[gwps$Species=="CH4"],1)) %>%
mutate(gwp=ifelse(var=="n2o",gwps$AR6GWP100[gwps$Species=="N2O"],gwp)) %>%
mutate(value_gwp=value*gwp)# %>%
blarg <- data_ghg %>% filter(year==2020)
data_ghg <- data_ghg %>%
mutate(gwp=ifelse(var=="ch4",gwps$AR6GWP100[gwps$Species=="CH4"],1)) %>%
mutate(gwp=ifelse(var=="n2o",gwps$AR6GWP100[gwps$Species=="N2O"],gwp)) %>%
mutate(value_gwp=value*gwp) %>%
mutate(value=ifelse(var %in% c("ch4","n2o"),value/1000,value))
data_ghg <- rbind(data_gcb_co2_ffi,data_gcb_co2_luc)
data_ghg <- rbind(data_ghg,data_gfed_ch4)
data_ghg <- rbind(data_ghg,data_gfed_n2o)
data_ghg <- rbind(data_ghg,data_fgases)
data_ghg <- rbind(data_ghg,data_primap_cr_ch4)
data_ghg <- rbind(data_ghg,data_primap_cr_n2o)
data_ghg <- data_ghg %>%
filter(source!="H&C") %>%
filter(source!="OSCAR") %>%
filter(source!="BLUE")
## Convert CH4 and N2O to CO2e and fix units
data_ghg <- data_ghg %>%
mutate(gwp=ifelse(var=="ch4",gwps$AR6GWP100[gwps$Species=="CH4"],1)) %>%
mutate(gwp=ifelse(var=="n2o",gwps$AR6GWP100[gwps$Species=="N2O"],gwp)) %>%
mutate(value_gwp=value*gwp) %>%
mutate(value_gwp=ifelse(var %in% c("ch4","n2o"),value/1000,value))
blarg <- data_ghg %>% filter(year==2020)
data_ghg <- rbind(data_gcb_co2_ffi,data_gcb_co2_luc)
data_ghg <- rbind(data_ghg,data_gfed_ch4)
data_ghg <- rbind(data_ghg,data_gfed_n2o)
data_ghg <- rbind(data_ghg,data_fgases)
data_ghg <- rbind(data_ghg,data_primap_cr_ch4)
data_ghg <- rbind(data_ghg,data_primap_cr_n2o)
data_ghg <- data_ghg %>%
filter(source!="H&C") %>%
filter(source!="OSCAR") %>%
filter(source!="BLUE")
## Convert CH4 and N2O to CO2e and fix units
data_ghg <- data_ghg %>%
mutate(gwp=ifelse(var=="ch4",gwps$AR6GWP100[gwps$Species=="CH4"],1)) %>%
mutate(gwp=ifelse(var=="n2o",gwps$AR6GWP100[gwps$Species=="N2O"],gwp)) %>%
mutate(value_gwp=value*gwp) %>%
mutate(value_gwp=ifelse(var %in% c("ch4","n2o"),value_gwp/1000,value_gwp))
blarg <- data_ghg %>% filter(year==2020)
## remove ODS fgases
data_ghg <- data_ghg %>%
mutate(exclude=grepl("ODS",source)) %>%
filter(exclude=="FALSE") %>%
mutate(units="GtCO2e") %>%
select(-gwp,-exclude)
blarg <- data_ghg %>% filter(year==2020)
data_ghg <- data_ghg %>%
mutate(value=value_gwp) %>%
select(-value_gwp)
data_ghg <- data_ghg %>%
group_by(year,var,units) %>%
summarise(value=sum(value,na.rm=TRUE))
blarg <- data_ghg %>% filter(year==2020)
data_ghg <- data_ghg %>%
mutate(label=ifelse(var=="co2_ffi","CO2-FFI",NA)) %>%
mutate(label=ifelse(var=="co2_luc","CO2-LULUCF",label)) %>%
mutate(label=ifelse(var=="ch4","CH4",label)) %>%
mutate(label=ifelse(var=="n2o","N2O",label)) %>%
mutate(label=ifelse(is.na(label),"F-gases",label)) %>%
mutate(year=as.numeric(year))
blarg <- data_ghg %>% filter(year==2020)
data_table <- data_ghg %>%
mutate(cut=ifelse(year>=1970 & year <=1979,"1970-1979",NA)) %>%
mutate(cut=ifelse(year>=1980 & year <=1989,"1980-1989",cut)) %>%
mutate(cut=ifelse(year>=1990 & year <=1999,"1990-1999",cut)) %>%
mutate(cut=ifelse(year>=2000 & year <=2009,"2000-2009",cut)) %>%
mutate(cut=ifelse(year>=2010 & year <=2019,"2010-2019",cut))
data_table_ghgs <- data_table
data_table <- data_table %>%
filter(!is.na(cut)) %>%
group_by(label,cut) %>%
summarise(value=mean(value))
data_table <- data_ghg %>%
mutate(cut=ifelse(year>=1970 & year <=1979,"1970-1979",NA)) %>%
mutate(cut=ifelse(year>=1980 & year <=1989,"1980-1989",cut)) %>%
mutate(cut=ifelse(year>=1990 & year <=1999,"1990-1999",cut)) %>%
mutate(cut=ifelse(year>=2000 & year <=2009,"2000-2009",cut)) %>%
mutate(cut=ifelse(year>=2010 & year <=2019,"2010-2019",cut))
data_table_ghgs <- data_table
data_table <- data_table %>%
filter(!is.na(cut)) %>%
group_by(label,cut) %>%
summarise(value=mean(value))
## add the 2022 data
data_table <- rbind(data_table,data_ghg %>%
ungroup() %>%
filter(year==2022) %>%
rename(cut=year) %>%
mutate(cut=as.character(cut)) %>%
select(label,cut,value))
uncertainties = data.frame(label=c("CO2-FFI","CO2-LULUCF","CH4","N2O","F-gases"),uncertainty=c(0.08,0.7,0.3,0.6,0.3))
data_table <- left_join(data_table,uncertainties,by="label")
data_table <- data_table %>%
mutate(uncertainty_abs=value*uncertainty) %>%
mutate(value=signif(value,2)) %>%
mutate(uncertainty_abs=signif(uncertainty_abs,2))
data_table <- data_table %>%
mutate(value=paste0(value,"±",uncertainty_abs))
data_table_ghgs <- rbind(data_table_ghgs,data_ghg %>%
filter(year==2022) %>%
mutate(cut="2022"))
View(data_table_ghgs)
data_table_ghgs <- left_join(data_table_ghgs,uncertainties,by="label")
data_table_ghgs <- data_table_ghgs %>%
group_by(cut,label,uncertainty) %>%
summarise(value=mean(value,na.rm=TRUE))
data_table_ghgs <- data_table_ghgs %>%
mutate(uncertainty_abs=value*uncertainty) %>%
mutate(uncertainty_abs=uncertainty_abs^2) %>%
group_by(cut) %>%
summarise(value=sum(value,na.rm=TRUE),
uncertainty_abs=sqrt(sum(uncertainty_abs,na.rm=TRUE)))
data_table_ghgs <- data_table_ghgs %>%
mutate(label="GHG") %>%
mutate(value=signif(value,2)) %>%
mutate(uncertainty_abs=signif(uncertainty_abs,2)) %>%
mutate(value=paste0(value,"±",uncertainty_abs))
data_table <- rbind(data_table,data_table_ghgs)
data_table <- data_table %>%
select(-uncertainty,-uncertainty_abs)
data_table <- data_ghg %>%
mutate(cut=ifelse(year>=1970 & year <=1979,"1970-1979",NA)) %>%
mutate(cut=ifelse(year>=1980 & year <=1989,"1980-1989",cut)) %>%
mutate(cut=ifelse(year>=1990 & year <=1999,"1990-1999",cut)) %>%
mutate(cut=ifelse(year>=2000 & year <=2009,"2000-2009",cut)) %>%
mutate(cut=ifelse(year>=2010 & year <=2019,"2010-2019",cut))
data_table_ghgs <- data_table
data_table <- data_table %>%
filter(!is.na(cut)) %>%
group_by(label,cut) %>%
summarise(value=mean(value))
## add the 2022 data
data_table <- rbind(data_table,data_ghg %>%
ungroup() %>%
filter(year==2022) %>%
rename(cut=year) %>%
mutate(cut=as.character(cut)) %>%
select(label,cut,value))
## calculate uncertainties
uncertainties = data.frame(label=c("CO2-FFI","CO2-LULUCF","CH4","N2O","F-gases"),uncertainty=c(0.08,0.7,0.3,0.6,0.3))
data_table <- left_join(data_table,uncertainties,by="label")
data_table <- data_table %>%
mutate(uncertainty_abs=value*uncertainty) %>%
mutate(value=signif(value,2)) %>%
mutate(uncertainty_abs=signif(uncertainty_abs,2))
data_table <- data_table %>%
mutate(value=paste0(value,"±",uncertainty_abs))
## calculate total GHGs
data_table_ghgs <- rbind(data_table_ghgs,data_ghg %>%
filter(year==2022) %>%
mutate(cut="2022"))
data_table_ghgs <- left_join(data_table_ghgs,uncertainties,by="label")
data_table_ghgs <- data_table_ghgs %>%
group_by(cut,label,uncertainty) %>%
summarise(value=mean(value,na.rm=TRUE))
data_table_ghgs <- data_table_ghgs %>%
mutate(uncertainty_abs=value*uncertainty) %>%
mutate(uncertainty_abs=uncertainty_abs^2) %>%
group_by(cut) %>%
summarise(value=sum(value,na.rm=TRUE),
uncertainty_abs=sqrt(sum(uncertainty_abs,na.rm=TRUE)))
View(data_table_ghgs)
data_table <- data_ghg %>%
mutate(cut=ifelse(year>=1970 & year <=1979,"1970-1979",NA)) %>%
mutate(cut=ifelse(year>=1980 & year <=1989,"1980-1989",cut)) %>%
mutate(cut=ifelse(year>=1990 & year <=1999,"1990-1999",cut)) %>%
mutate(cut=ifelse(year>=2000 & year <=2009,"2000-2009",cut)) %>%
mutate(cut=ifelse(year>=2010 & year <=2019,"2010-2019",cut))
data_table_ghgs <- data_table
data_table <- data_table %>%
filter(!is.na(cut)) %>%
group_by(label,cut) %>%
summarise(value=mean(value))
## add the 2022 data
data_table <- rbind(data_table,data_ghg %>%
ungroup() %>%
filter(year==2022) %>%
rename(cut=year) %>%
mutate(cut=as.character(cut)) %>%
select(label,cut,value))
## calculate uncertainties
uncertainties = data.frame(label=c("CO2-FFI","CO2-LULUCF","CH4","N2O","F-gases"),uncertainty=c(0.08,0.7,0.3,0.6,0.3))
data_table <- left_join(data_table,uncertainties,by="label")
data_table <- data_table %>%
mutate(uncertainty_abs=value*uncertainty) %>%
mutate(value=signif(value,2)) %>%
mutate(uncertainty_abs=signif(uncertainty_abs,2))
data_table <- data_table %>%
mutate(value=paste0(value,"±",uncertainty_abs))
## calculate total GHGs
data_table_ghgs <- rbind(data_table_ghgs,data_ghg %>%
filter(year==2022) %>%
mutate(cut="2022"))
# data_table_ghgs <- rbind(data_table_ghgs,data_table_ghgs %>%
#   filter(year>=2010) %>%
#   filter(year<=2019) %>%
#   mutate(cut="2010-2019")) %>%
#   filter(!is.na(cut))
data_table_ghgs <- left_join(data_table_ghgs,uncertainties,by="label")
data_table_ghgs <- data_table_ghgs %>%
group_by(cut,label,uncertainty) %>%
summarise(value=mean(value,na.rm=TRUE))
data_table_ghgs <- data_table_ghgs %>%
mutate(uncertainty_abs=value*uncertainty) %>%
mutate(uncertainty_abs=uncertainty_abs^2) %>%
filter(is.na(cut)) %>%
group_by(cut) %>%
summarise(value=sum(value,na.rm=TRUE),
uncertainty_abs=sqrt(sum(uncertainty_abs,na.rm=TRUE)))
data_table_ghgs <- data_table_ghgs %>%
mutate(label="GHG") %>%
mutate(value=signif(value,2)) %>%
mutate(uncertainty_abs=signif(uncertainty_abs,2)) %>%
mutate(value=paste0(value,"±",uncertainty_abs))
data_table <- rbind(data_table,data_table_ghgs)
data_table <- data_table %>%
select(-uncertainty,-uncertainty_abs)
data_table <- data_ghg %>%
mutate(cut=ifelse(year>=1970 & year <=1979,"1970-1979",NA)) %>%
mutate(cut=ifelse(year>=1980 & year <=1989,"1980-1989",cut)) %>%
mutate(cut=ifelse(year>=1990 & year <=1999,"1990-1999",cut)) %>%
mutate(cut=ifelse(year>=2000 & year <=2009,"2000-2009",cut)) %>%
mutate(cut=ifelse(year>=2010 & year <=2019,"2010-2019",cut))
data_table_ghgs <- data_table
data_table <- data_table %>%
filter(!is.na(cut)) %>%
group_by(label,cut) %>%
summarise(value=mean(value))
## add the 2022 data
data_table <- rbind(data_table,data_ghg %>%
ungroup() %>%
filter(year==2022) %>%
rename(cut=year) %>%
mutate(cut=as.character(cut)) %>%
select(label,cut,value))
## calculate uncertainties
uncertainties = data.frame(label=c("CO2-FFI","CO2-LULUCF","CH4","N2O","F-gases"),uncertainty=c(0.08,0.7,0.3,0.6,0.3))
data_table <- left_join(data_table,uncertainties,by="label")
data_table <- data_table %>%
mutate(uncertainty_abs=value*uncertainty) %>%
mutate(value=signif(value,2)) %>%
mutate(uncertainty_abs=signif(uncertainty_abs,2))
data_table <- data_table %>%
mutate(value=paste0(value,"±",uncertainty_abs))
## calculate total GHGs
data_table_ghgs <- rbind(data_table_ghgs,data_ghg %>%
filter(year==2022) %>%
mutate(cut="2022"))
# data_table_ghgs <- rbind(data_table_ghgs,data_table_ghgs %>%
#   filter(year>=2010) %>%
#   filter(year<=2019) %>%
#   mutate(cut="2010-2019")) %>%
#   filter(!is.na(cut))
data_table_ghgs <- left_join(data_table_ghgs,uncertainties,by="label")
data_table_ghgs <- data_table_ghgs %>%
group_by(cut,label,uncertainty) %>%
summarise(value=mean(value,na.rm=TRUE))
data_table_ghgs <- data_table_ghgs %>%
mutate(uncertainty_abs=value*uncertainty) %>%
mutate(uncertainty_abs=uncertainty_abs^2) %>%
filter(!is.na(cut)) %>%
group_by(cut) %>%
summarise(value=sum(value,na.rm=TRUE),
uncertainty_abs=sqrt(sum(uncertainty_abs,na.rm=TRUE)))
data_table_ghgs <- data_table_ghgs %>%
mutate(label="GHG") %>%
mutate(value=signif(value,2)) %>%
mutate(uncertainty_abs=signif(uncertainty_abs,2)) %>%
mutate(value=paste0(value,"±",uncertainty_abs))
data_table <- rbind(data_table,data_table_ghgs)
data_table <- data_table %>%
select(-uncertainty,-uncertainty_abs)
## add GCB 2022 projections
data_table <- data_table %>%
ungroup() %>%
add_row(label="CO2-FFI",cut="2023 (projection)",value="X") %>%
add_row(label="CO2-LULUCF",cut="2023 (projection)",value="X")
data_table$label <- as.factor(data_table$label)
data_table$label <- fct_relevel(data_table$label,"GHG","CO2-FFI","CO2-LULUCF","CH4","N2O","F-gases")
data_table <- spread(data_table,cut,value)
data_ghg_original <- rbind(data_gcb_co2_ffi,data_gcb_co2_luc %>% filter(source=="GCB v2022*"))
data_ghg_original <- rbind(data_ghg_original,data_primap_cr_ch4)
data_ghg_original <- rbind(data_ghg_original,data_primap_cr_n2o)
data_ghg_original <- rbind(data_ghg_original,data_fgases %>% filter(grepl("UNFCCC",source)))
data_ghg_original <- rbind(data_gcb_co2_ffi,data_gcb_co2_luc %>% filter(source=="GCB v2022*"))
data_ghg_original <- rbind(data_ghg_original,data_primap_cr_ch4)
data_ghg_original <- rbind(data_ghg_original,data_primap_cr_n2o)
data_ghg_original <- rbind(data_ghg_original,data_fgases %>% filter(grepl("UNFCCC",source)))
data_ghg_original <- rbind(data_ghg_original,data_gfed_ch4)
data_ghg_original <- rbind(data_ghg_original,data_gfed_n2o)
data_ghg_original <- left_join(data_ghg_original,data_ghg %>% select(var,label) %>% distinct(),by="var")
View(data_ghg_original)
data_ghg_original <- rbind(data_gcb_co2_ffi,data_gcb_co2_luc %>% filter(source=="GCB v2022*"))
data_ghg_original <- rbind(data_ghg_original,data_primap_cr_ch4)
data_ghg_original <- rbind(data_ghg_original,data_primap_cr_n2o)
data_ghg_original <- rbind(data_ghg_original,data_fgases %>% filter(grepl("UNFCCC",source)))
data_ghg_original <- rbind(data_ghg_original,data_gfed_ch4)
data_ghg_original <- rbind(data_ghg_original,data_gfed_n2o)
data_ghg_original <- left_join(data_ghg_original,data_ghg %>% ungroup() %>% select(var,label) %>% distinct(),by="var")
View(data_gfed_ch4)
View(data_gfed_n2o)
