filter(year>=1970) %>%
group_by(year) %>%
summarise(`CO2-LUC`=sum(mean,na.rm=TRUE)))
data_ar6  <- gather(data_ar6,label,value_ar6,-year) %>%
mutate(value_ar6=value_ar6/1e9) %>%
mutate(label=ifelse(label=="CO2","CO2-FFI",label)) %>%
mutate(label=ifelse(label=="Fgas","F-gases",label)) %>%
mutate(label=ifelse(label=="CO2-LUC","CO2-LULUCF",label))
### 2019
data_comparison <- left_join(data_ghg,data_ar6) %>%
filter(year==2019)
data_comparison <- left_join(data_comparison,uncertainties,by="label")
data_comparison <- data_comparison %>%
mutate(difference=value-value_ar6)
#
# data_comparison <- data_comparison %>%
#   filter(var!="co2_luc") %>%
#   filter(var!="ch4")
# sum(data_comparison$difference)
data_comparison <- data_comparison %>%
mutate(uncertainty_abs=value*uncertainty) %>%
mutate(uncertainty_abs=uncertainty_abs^2) %>%
group_by(year) %>%
summarise(value=sum(value,na.rm=TRUE),
uncertainty_abs=sqrt(sum(uncertainty_abs,na.rm=TRUE)))
View(data_comparison)
data_comparison <- data_ghg %>%
filter(year>=2010) %>%
filter(year<=2019) %>%
group_by(label) %>%
summarise(value=mean(value))
data_comparison <- left_join(data_comparison,data_ar6 %>%
filter(year>=2010) %>%
filter(year<=2019) %>%
group_by(label) %>%
summarise(value_ar6=mean(value_ar6)),by="label")
sum(data_comparison$value)-sum(data_comparison$value_ar6)
data_comparison <- left_join(data_comparison,uncertainties,by="label")
data_comparison <- data_comparison %>%
mutate(uncertainty_abs=value*uncertainty) %>%
mutate(uncertainty_abs=uncertainty_abs^2) %>%
mutate(year="2010-2019") %>%
group_by(year) %>%
summarise(value=sum(value,na.rm=TRUE),
uncertainty_abs=sqrt(sum(uncertainty_abs,na.rm=TRUE)))
load("sources/IPCC AR6 WG3 data/data_land_co2.RData")
load("sources/IPCC AR6 WG3 data/data_edgar_ghg.RData")
data_ar6 <- edgar_ghg %>%
group_by(year) %>%
summarise_at(vars(CO2,CH4,N2O,Fgas),sum,na.rm=TRUE)
data_ar6 <- left_join(data_ar6,land %>%
filter(year>=1970) %>%
group_by(year) %>%
summarise(`CO2-LUC`=sum(mean,na.rm=TRUE)))
data_ar6  <- gather(data_ar6,label,value_ar6,-year) %>%
mutate(value_ar6=value_ar6/1e9) %>%
mutate(label=ifelse(label=="CO2","CO2-FFI",label)) %>%
mutate(label=ifelse(label=="Fgas","F-gases",label)) %>%
mutate(label=ifelse(label=="CO2-LUC","CO2-LULUCF",label))
data_comparison <- left_join(data_ghg,data_ar6) %>%
filter(year==2019)
data_comparison <- left_join(data_comparison,uncertainties,by="label")
data_comparison <- data_comparison %>%
mutate(difference=value-value_ar6)
data_comparison <- data_comparison %>%
filter(var!="co2_luc") %>%
filter(var!="ch4")
sum(data_comparison$difference)
blarg <- data_primap %>% select(category) %>% distinct()
View(blarg)
data_primap <- read.csv("sources/PRIMAP/Guetschow_et_al_2024-PRIMAP-hist_v2.5.1_final_27-Feb-2024.csv")
data_primap <- gather(data_primap,year,value,X1750:X2022)
data_primap$year <- gsub("X","",data_primap$year)
names(data_primap) <- c("source","scenario","provenance","area","gas","unit","category","year","value")
blarg <- data_primap %>% select(category) %>% distinct()
View(blarg)
knitr::opts_chunk$set(echo = FALSE)
rm(list = ls())
library(tidyverse)
library(openxlsx)
library(countrycode)
library(ggrepel)
library(patchwork)
library(zoo)
library(RColorBrewer)
## location of % shares in stacked figures
locate_shares <- function(data,grouping,years){
shares <- data %>%
arrange_at(vars(`year`,all_of(grouping))) %>%
mutate(location=value/2)
z = length(unique(shares[,grouping]))
for (j in seq(0,z*(years-1),z)) {
# for every region
for (i in 1:z) {
if (i != z) {
shares$location[i+j] = shares$location[i+j] + sum(shares$value[i+1+j:(z-i+j-1)])
#shares$location[i] = shares$location[i] + sum(shares$value[i+1:(z-i))])
}
}
}
return(shares)
}
## figure style
theme_wl <- function() {
font <- "sans"
theme_bw() %+replace%
theme(
# Grid elements
panel.grid.minor = element_blank(),    #strip minor gridlines
axis.ticks = element_line(color="#636363",size = 0.7),          #strip axis ticks
# Border lines
panel.border = element_rect(color="#636363",fill=NA,size = 0.7),
panel.background = element_blank(),
# Text elements
plot.title = element_text(             #title
family = font,            #set font family
size = 14,                #set font size
face = 'bold',            #bold typeface
hjust = 0,                #left align
vjust = 3,                #raise slightly
color = '#636363'),       #color
plot.subtitle = element_text(
family = font,
size = 12,
hjust = 0,
vjust = 2,
color = '#636363'),
plot.caption = element_text(           #caption
family = font,            #font family
size = 9,                 #font size
hjust = 0,                #right align
color = '#bdbdbd'),       #color
axis.title = element_text(             #axis titles
family = font,            #font family
size = 10,                #font size
color = '#636363'),       #color
axis.text = element_text(              #axis text
family = font,            #axis famuly
size = 9,                 #font size
color = '#636363'),       #color
axis.text.x = element_text(            #margin for axis text
margin=margin(5, b = 10)),
text = element_text(
family = font,
color = '#636363')
)
}
## F-gas emissions (from Chris Smith's inversions)
data_inversions_fgases <- read.csv("sources/fgas_inversions_Smith_2024.csv")
data_inversions_fgases <- gather(data_inversions_fgases,gas,value,-timepoints)
data_inversions_fgases$gas <- gsub("\\.","-",data_inversions_fgases$gas)
data_inversions_fgases <- data_inversions_fgases %>%
mutate(year=timepoints-0.5)
gwps_ar6 <- read.csv("https://raw.githubusercontent.com/chrisroadmap/ar6/main/data_output/7sm/metrics_supplement_cleaned.csv")
list_fgases <- data_inversions_fgases %>% select(gas) %>% distinct()
list_fgases <- left_join(list_fgases,gwps_ar6 %>% select(gas=Acronym,AR6GWP100=GWP100))
list_fgases <- left_join(list_fgases,gwps_ar6 %>% select(gas=Formula,AR6GWP100_2=GWP100,acronym=Acronym))
list_fgases <- list_fgases %>%
mutate(category=ifelse(grepl("NF3",gas),"NF3",NA)) %>%
mutate(category=ifelse(grepl("SF6",gas),"SF6",category)) %>%
mutate(category=ifelse(grepl("HFC",gas),"HFCs",category)) %>%
mutate(category=ifelse(grepl("CFC",gas),"CFCs",category)) %>%
mutate(category=ifelse(grepl("HCFC",gas),"HCFCs",category)) %>%
mutate(category=ifelse(grepl("Halon",gas),"Halons",category)) %>%
mutate(category=ifelse(grepl("PFC",acronym),"PFCs",category)) %>%
mutate(category=ifelse(gas=="i-C6F14","PFCs",category)) %>%
mutate(category=ifelse(gas=="c-C4F8","PFCs",category)) %>%
mutate(category=ifelse(gas=="C7F16","PFCs",category)) %>%
mutate(category=ifelse(gas=="C8F18","PFCs",category)) %>%
mutate(category=ifelse(is.na(category),"Other",category))
list_fgases <- list_fgases %>%
mutate(group=ifelse(grepl("NF3",category),"UNFCCC F-gases",NA)) %>%
mutate(group=ifelse(grepl("SF6",category),"UNFCCC F-gases",group)) %>%
mutate(group=ifelse(grepl("HFCs",category),"UNFCCC F-gases",group)) %>%
mutate(group=ifelse(grepl("PFC",category),"UNFCCC F-gases",group)) %>%
mutate(group=ifelse(is.na(group),"ODS F-gases",group))
list_fgases <- list_fgases %>%
mutate(AR6GWP100=ifelse(is.na(AR6GWP100),AR6GWP100_2,AR6GWP100)) %>%
select(-AR6GWP100_2,-acronym)
## manual adjustments to fill missing values based on conversation with Chris Smith
list_fgases <- list_fgases %>%
mutate(AR6GWP100=ifelse(gas=="c-C4F8",10200,AR6GWP100)) %>%   # from openclimatedata
mutate(AR6GWP100=ifelse(gas=="i-C6F14",8620,AR6GWP100)) %>%   # same as the n-form
mutate(AR6GWP100=ifelse(gas=="C7F16",8410,AR6GWP100)) %>%     # same as the n-form
mutate(AR6GWP100=ifelse(gas=="C8F18",8260,AR6GWP100))         # same as the n-form
#write.xlsx(list_fgases,"list_fgases.xlsx")
data_inversions_fgases <- left_join(data_inversions_fgases,list_fgases)
data_inversions_fgases <- data_inversions_fgases %>% mutate(value=value*AR6GWP100)
data_inversions_fgases <- data_inversions_fgases %>%
group_by(year,group) %>%
summarise(value=sum(value,na.rm=TRUE)/1e6) %>%
mutate(source=ifelse(group=="ODS F-gases","CIP v2024.04\n [ODS F-gases]","CIP v2024.04*")) %>%
mutate(var="fgases") %>%
mutate(units="GtCO2e") %>%
select(-group)
## Global Carbon Project CO2 FFI (https://globalcarbonbudget.org/carbonbudget2023/)
data_gcb_co2_ffi <- read.xlsx("sources/GCB/Global_Carbon_Budget_2023v1.1-Alissa-Haward.xlsx",sheet=2,startRow = 22)
data_gcb_co2_ffi <- data_gcb_co2_ffi %>%
select(year=Year,value=fossil.emissions.excluding.carbonation)
data_gcb_co2_ffi <- data_gcb_co2_ffi %>%
mutate(source="GCB v2023*") %>%
mutate(value=value*(44/12)) %>%
mutate(var="co2_ffi") %>%
mutate(units="GtCO2")
## Global Carbon Project CO2 LUC (https://globalcarbonbudget.org/carbonbudget2023/)
data_gcb_co2_luc <- read.xlsx("sources/GCB/Global_Carbon_Budget_2023v1.1-Alissa-Haward.xlsx",sheet=5,startRow = 38,cols = c(1,2,9,14,19))
names(data_gcb_co2_luc) <- c("year","GCB v2023*","BLUE","H&C","OSCAR")
data_gcb_co2_luc <- gather(data_gcb_co2_luc,source,value,-year)
data_gcb_co2_luc <- data_gcb_co2_luc %>%
mutate(value=value*(44/12)) %>%
mutate(var="co2_luc") %>%
mutate(units="GtCO2")
# EDGAR CO2 (https://edgar.jrc.ec.europa.eu/dataset_ghg80)
data_edgar_co2_ffi <- read.xlsx("sources/EDGAR/IEA_EDGAR_CO2_1970_2022.xlsx",sheet=2,startRow = 10)
data_edgar_co2_ffi <- gather(data_edgar_co2_ffi,year,value,Y_1970:Y_2022)
data_edgar_co2_ffi$year <- gsub("Y_","",data_edgar_co2_ffi$year)
data_edgar_co2_ffi <- data_edgar_co2_ffi %>%
select(iso=Country_code_A3,country=Name,code=ipcc_code_2006_for_standard_report,gas=Substance,fossil_bio,year,value)
data_edgar_co2_ffi <- data_edgar_co2_ffi %>%
filter(fossil_bio=="fossil") %>%
group_by(year) %>%
summarise(value=sum(value,na.rm=TRUE)/1e6) %>%
mutate(units="GtCO2") %>%
mutate(source="EDGAR v8.0") %>%
mutate(var="co2_ffi")
# EDGAR CH4 (https://edgar.jrc.ec.europa.eu/dataset_ghg80)
data_edgar_ch4 <- read.xlsx("sources/EDGAR/EDGAR_CH4_1970_2022.xlsx",sheet=2,startRow = 10)
data_edgar_ch4 <- gather(data_edgar_ch4,year,value,Y_1970:Y_2022)
data_edgar_ch4$year <- gsub("Y_","",data_edgar_ch4$year)
data_edgar_ch4 <- data_edgar_ch4 %>%
select(iso=Country_code_A3,country=Name,code=ipcc_code_2006_for_standard_report,gas=Substance,fossil_bio,year,value)
data_edgar_ch4 <- data_edgar_ch4 %>%
group_by(year) %>%
summarise(value=sum(value,na.rm=TRUE)/1000) %>%
mutate(units="MtCH4") %>%
mutate(source="EDGAR v8.0") %>%
mutate(var="ch4")
# EDGAR N2O (https://edgar.jrc.ec.europa.eu/dataset_ghg80)
data_edgar_n2o <- read.xlsx("sources/EDGAR/EDGAR_N2O_1970_2022.xlsx",sheet=2,startRow = 10)
data_edgar_n2o <- gather(data_edgar_n2o,year,value,Y_1970:Y_2022)
data_edgar_n2o$year <- gsub("Y_","",data_edgar_n2o$year)
data_edgar_n2o <- data_edgar_n2o %>%
select(iso=Country_code_A3,country=Name,code=ipcc_code_2006_for_standard_report,gas=Substance,fossil_bio,year,value)
data_edgar_n2o <- data_edgar_n2o %>%
group_by(year) %>%
summarise(value=sum(value,na.rm=TRUE)/1000) %>%
mutate(units="MtN2O") %>%
mutate(source="EDGAR v8.0") %>%
mutate(var="n2o")
# EDGAR Fgases (https://edgar.jrc.ec.europa.eu/dataset_ghg80)
data_edgar_fgases <- read.xlsx("sources/EDGAR/EDGAR_F-gases_1990_2022.xlsx",sheet=2,startRow = 10)
data_edgar_fgases <- gather(data_edgar_fgases,year,value,Y_1990:Y_2022)
data_edgar_fgases$year <- gsub("Y_","",data_edgar_fgases$year)
data_edgar_fgases <- data_edgar_fgases %>%
select(iso=Country_code_A3,country=Name,code=ipcc_code_2006_for_standard_report,gas=Substance,fossil_bio,year,value)
data_edgar_fgases <- data_edgar_fgases %>%
mutate(gas=ifelse(gas=="HFC-43-10-mee","HFC-43-10mee",gas))
data_edgar_fgases <- left_join(data_edgar_fgases,list_fgases %>% mutate(gas=gsub("n-","",gas)),by="gas")
data_edgar_fgases <- left_join(data_edgar_fgases,gwps_ar6 %>% select(gas=Acronym,AR6GWP100_2=GWP100),by="gas")
data_edgar_fgases <- data_edgar_fgases %>%
mutate(AR6GWP100=ifelse(is.na(AR6GWP100),AR6GWP100_2,AR6GWP100)) %>%
select(-AR6GWP100_2) %>%
mutate(category=ifelse(grepl("HFC",gas),"HFCs",category)) %>%
mutate(group=ifelse(grepl("HFCs",category),"UNFCCC F-gases",group))
data_edgar_fgases <- data_edgar_fgases %>%
mutate(value=value*AR6GWP100)
data_edgar_fgases <- data_edgar_fgases %>%
filter(group!="ODS F-gases") %>%
group_by(year) %>%
summarise(value=sum(value,na.rm=TRUE)/1e6) %>%
mutate(source="EDGAR v8.0") %>%
mutate(var="fgases") %>%
mutate(units="GtCO2e")
# CEDS CH4 (https://zenodo.org/records/10904361)
data_ceds_ch4 <- read.csv("sources/CEDS v2024.04.01/CH4_CEDS_emissions_by_country_v2024_04_01.csv")
data_ceds_ch4 <- gather(data_ceds_ch4,year,value,X1970:X2022)
data_ceds_ch4$year <- gsub("X","",data_ceds_ch4$year)
data_ceds_ch4 <- data_ceds_ch4 %>%
select(iso=country,gas=em,year,value)
data_ceds_ch4 <- data_ceds_ch4 %>%
group_by(year) %>%
summarise(value=sum(value,na.rm=TRUE)/1000) %>%
mutate(units="MtCH4") %>%
mutate(source="CEDS v2024.4.1") %>%
mutate(var="ch4")
# # CEDS CH4 (https://zenodo.org/record/4741285)
#
# data_ceds_ch4 <- read.csv("sources/CEDS v2021.4.21/CH4_CEDS_emissions_by_country_2021_04_21.csv")
# data_ceds_ch4 <- gather(data_ceds_ch4,year,value,X1970:X2019)
# data_ceds_ch4$year <- gsub("X","",data_ceds_ch4$year)
# data_ceds_ch4 <- data_ceds_ch4 %>%
#   select(iso=country,gas=em,year,value)
#
# data_ceds_ch4 <- data_ceds_ch4 %>%
#   group_by(year) %>%
#   summarise(value=sum(value,na.rm=TRUE)/1000) %>%
#   mutate(units="MtCH4") %>%
#   mutate(source="CEDS v2021.4.21") %>%
#   mutate(var="ch4")
# CEDS CO2 (https://zenodo.org/records/10904361)
data_ceds_co2_ffi <- read.csv("sources/CEDS v2024.04.01/CO2_CEDS_emissions_by_country_v2024_04_01.csv")
data_ceds_co2_ffi <- gather(data_ceds_co2_ffi,year,value,X1750:X2022)
data_ceds_co2_ffi$year <- gsub("X","",data_ceds_co2_ffi$year)
data_ceds_co2_ffi <- data_ceds_co2_ffi %>%
select(iso=country,gas=em,year,value)
data_ceds_co2_ffi <- data_ceds_co2_ffi %>%
group_by(year) %>%
summarise(value=sum(value,na.rm=TRUE)/1e6) %>%
mutate(units="GtCO2") %>%
mutate(source="CEDS v2024.4.1") %>%
mutate(var="co2_ffi")
# # CEDS CO2 (https://zenodo.org/record/4741285)
#
# data_ceds_co2_ffi <- read.csv("sources/CEDS v2021.4.21/CO2_CEDS_emissions_by_country_2021_04_21.csv")
# data_ceds_co2_ffi <- gather(data_ceds_co2_ffi,year,value,X1750:X2019)
# data_ceds_co2_ffi$year <- gsub("X","",data_ceds_co2_ffi$year)
# data_ceds_co2_ffi <- data_ceds_co2_ffi %>%
#   select(iso=country,gas=em,year,value)
#
# data_ceds_co2_ffi <- data_ceds_co2_ffi %>%
#   group_by(year) %>%
#   summarise(value=sum(value,na.rm=TRUE)/1e6) %>%
#   mutate(units="GtCO2") %>%
#   mutate(source="CEDS v2021.4.21") %>%
#   mutate(var="co2_ffi")
# CEDS N2O (https://zenodo.org/records/10904361)
data_ceds_n2o <- read.csv("sources/CEDS v2024.04.01/N2O_CEDS_emissions_by_country_v2024_04_01.csv")
data_ceds_n2o <- gather(data_ceds_n2o,year,value,X1970:X2022)
data_ceds_n2o$year <- gsub("X","",data_ceds_n2o$year)
data_ceds_n2o <- data_ceds_n2o %>%
select(iso=country,gas=em,year,value)
data_ceds_n2o <- data_ceds_n2o %>%
group_by(year) %>%
summarise(value=sum(value,na.rm=TRUE)/1000) %>%
mutate(units="MtN2O") %>%
mutate(source="CEDS v2024.4.1") %>%
mutate(var="n2o")
# # CEDS N2O (https://zenodo.org/record/4741285)
#
# data_ceds_n2o <- read.csv("sources/CEDS v2021.4.21/N2O_CEDS_emissions_by_country_2021_04_21.csv")
# data_ceds_n2o <- gather(data_ceds_n2o,year,value,X1970:X2019)
# data_ceds_n2o$year <- gsub("X","",data_ceds_n2o$year)
# data_ceds_n2o <- data_ceds_n2o %>%
#   select(iso=country,gas=em,year,value)
#
# data_ceds_n2o <- data_ceds_n2o %>%
#   group_by(year) %>%
#   summarise(value=sum(value,na.rm=TRUE)/1000) %>%
#   mutate(units="MtN2O") %>%
#   mutate(source="CEDS v2021.4.21") %>%
#   mutate(var="n2o")
# PRIMAP (https://zenodo.org/records/10705513)
data_primap <- read.csv("sources/PRIMAP/Guetschow_et_al_2024-PRIMAP-hist_v2.5.1_final_27-Feb-2024.csv")
data_primap <- gather(data_primap,year,value,X1750:X2022)
data_primap$year <- gsub("X","",data_primap$year)
names(data_primap) <- c("source","scenario","provenance","area","gas","unit","category","year","value")
data_primap <- data_primap %>%
filter(category=="M.0.EL") %>%
filter(area=="EARTH")
data_primap_cr_n2o <- data_primap %>%
filter(scenario=="HISTCR") %>%
filter(gas=="N2O") %>%
group_by(year) %>%
summarise(value=sum(value,na.rm = TRUE)/1000) %>%
mutate(units="MtN2O") %>%
mutate(source="PRIMAP CR v2.5.1*") %>%
mutate(var="n2o")
data_primap_cr_ch4 <- data_primap %>%
filter(scenario=="HISTCR") %>%
filter(gas=="CH4") %>%
group_by(year) %>%
summarise(value=sum(value,na.rm = TRUE)/1000) %>%
mutate(units="MtCH4") %>%
mutate(source="PRIMAP CR v2.5.1*") %>%
mutate(var="ch4")
data_primap_cr_co2_ffi <- data_primap %>%
filter(scenario=="HISTCR") %>%
filter(gas=="CO2") %>%
group_by(year) %>%
summarise(value=sum(value,na.rm = TRUE)/1e6) %>%
mutate(units="GtCO2") %>%
mutate(source="PRIMAP CR v2.5.1") %>%
mutate(var="co2_ffi")
data_primap_cr_fgases <- data_primap %>%
filter(scenario=="HISTCR") %>%
filter(gas=="FGASES (AR6GWP100)") %>%
group_by(year) %>%
summarise(value=sum(value,na.rm = TRUE)/1e6) %>%
mutate(units="GtCO2") %>%
mutate(source="PRIMAP CR v2.5.1") %>%
mutate(var="fgases")
# PRIMAP (TP)
data_primap_tp_n2o <- data_primap %>%
filter(scenario=="HISTTP") %>%
filter(gas=="N2O") %>%
group_by(year) %>%
summarise(value=sum(value,na.rm = TRUE)/1000) %>%
mutate(units="MtN2O") %>%
mutate(source="PRIMAP TP v2.5.1") %>%
mutate(var="n2o")
data_primap_tp_ch4 <- data_primap %>%
filter(scenario=="HISTTP") %>%
filter(gas=="CH4") %>%
group_by(year) %>%
summarise(value=sum(value,na.rm = TRUE)/1000) %>%
mutate(units="MtCH4") %>%
mutate(source="PRIMAP TP v2.5.1") %>%
mutate(var="ch4")
data_primap_tp_co2_ffi <- data_primap %>%
filter(scenario=="HISTTP") %>%
filter(gas=="CO2") %>%
group_by(year) %>%
summarise(value=sum(value,na.rm = TRUE)/1e6) %>%
mutate(units="GtCO2") %>%
mutate(source="PRIMAP TP v2.5.1") %>%
mutate(var="co2_ffi")
data_primap_tp_fgases <- data_primap %>%
filter(scenario=="HISTTP") %>%
filter(gas=="FGASES (AR6GWP100)") %>%
group_by(year) %>%
summarise(value=sum(value,na.rm = TRUE)/1e6) %>%
mutate(units="GtCO2") %>%
mutate(source="PRIMAP TP v2.5.1") %>%
mutate(var="fgases")
## F-gas emissions (from Chris Smith's compiled data)
#
# data_fgases <- read.csv("sources/smith-hall-inversions-1750-2023.csv")
# list_fgases <- c(data_fgases$Variable[5:6],data_fgases$Variable[14:51])
# data_fgases <- gather(data_fgases,year,value,X1750:X2023)
# data_fgases$year <- gsub("X","",data_fgases$year)
# data_fgases <- data_fgases %>%
#   mutate(gas=Variable) %>%
#   select(var=Variable,gas,units=Unit,year,value) %>%
#   filter(var %in% c(list_fgases))
#
# data_fgases$gas <- gsub("Emissions","",data_fgases$gas)
# data_fgases$gas <- gsub("\\|","",data_fgases$gas)
# data_fgases$gas <- gsub("-","",data_fgases$gas)
#
# #join GWPs from openclimatedata
#
gwps <- read.csv("https://raw.githubusercontent.com/openclimatedata/globalwarmingpotentials/main/globalwarmingpotentials.csv",skip = 9)
#
# data_fgases <- left_join(data_fgases,gwps %>% select(gas=Species,AR6GWP100))
#
# data_fgases <- data_fgases %>%
#   mutate(value=value*AR6GWP100)
#
# list_fgases <- data.frame(var=list_fgases)
# list_fgases <- list_fgases %>%
#   mutate(group=ifelse(grepl("CFC",var),"ODS F-gases",NA)) %>%
#   mutate(group=ifelse(grepl("HCFC",var),"ODS F-gases",group)) %>%
#   mutate(group=ifelse(grepl("HFC",var),"UNFCCC F-gases",group)) %>%
#   mutate(group=ifelse(grepl("Halon",var),"ODS F-gases",group)) %>%
#   mutate(group=ifelse(grepl("NF3",var),"UNFCCC F-gases",group)) %>%
#   mutate(group=ifelse(grepl("SF6",var),"UNFCCC F-gases",group)) %>%
#   mutate(group=ifelse(is.na(group),"UNFCCC F-gases",group))
#
# data_fgases <- left_join(data_fgases,list_fgases,by="var")
#
# data_fgases <- data_fgases %>%
#   group_by(year,group) %>%
#   summarise(value=sum(value,na.rm=TRUE)/1e6) %>%
#   mutate(source=ifelse(group=="ODS F-gases",paste0(group,"\n CIP v2024.04"),paste0(group,"\n CIP v2024.04*"))) %>%
#   mutate(var="fgases") %>%
#   mutate(units="GtCO2e") %>%
#   select(-group)
## GFED CH4 data (https://www.geo.vu.nl/~gwerf/GFED/GFED4/tables/GFED4.1s_CH4.txt)
data_gfed_ch4 <- read.xlsx("sources/GFED/GFED4.1s_2024.xlsx",sheet="GFED_CH4",rows = c(14,29))
data_gfed_ch4 <- gather(data_gfed_ch4,year,value,`1997`:`2023`)
data_gfed_ch4 <- data_gfed_ch4 %>%
mutate(var="ch4") %>%
select(year,var,value) %>%
mutate(value=value*1E10) %>% #1e10 grams to grams
mutate(value=value/1e6) %>%
mutate(value=value/1e6) %>%
mutate(source="GFED v4.1*") %>%
mutate(units="MtCH4") %>%
select(year,value,source,var,units)
## GFED N2O data (https://www.geo.vu.nl/~gwerf/GFED/GFED4/tables/GFED4.1s_N2O.txt)
data_gfed_n2o <- read.xlsx("sources/GFED/GFED4.1s_2024.xlsx",sheet="GFED_N2O",rows = c(14,29))
data_gfed_n2o <- gather(data_gfed_n2o,year,value,`1997`:`2023`)
data_gfed_n2o <- data_gfed_n2o %>%
mutate(var="n2o") %>%
mutate(value=value*1E9) %>% #1e9 grams to grams
mutate(value=value/1e6) %>%
mutate(value=value/1e6) %>%
mutate(source="GFED v4.1*") %>%
mutate(units="MtN2O") %>%
select(year,value,source,var,units)
## GFED extention to before 1997 using CMIP6 (https://github.com/openclimatedata/global-biomass-burning-emissions/blob/main/data/gbbe-extended.csv)
data_gfed_extension <- read.csv("https://raw.githubusercontent.com/openclimatedata/global-biomass-burning-emissions/main/data/gbbe-extended.csv")
data_gfed_extension <- data_gfed_extension %>%
select(year=Year,CH4,N2O) %>%
mutate(year=as.character(year))
data_gfed_ch4 <- full_join(data_gfed_ch4,data_gfed_extension %>% select(year,CH4))
data_gfed_ch4 <- data_gfed_ch4 %>%
mutate(source=na.locf(source)) %>%
mutate(var=na.locf(var)) %>%
mutate(units=na.locf(units)) %>%
arrange(year) %>%
mutate(value=ifelse(year<1997,CH4,value)) %>%
select(-CH4)
data_gfed_n2o <- full_join(data_gfed_n2o,data_gfed_extension %>% select(year,N2O))
data_gfed_n2o <- data_gfed_n2o %>%
mutate(source=na.locf(source)) %>%
mutate(var=na.locf(var)) %>%
mutate(units=na.locf(units)) %>%
arrange(year) %>%
mutate(value=ifelse(year<1997,N2O,value)) %>%
select(-N2O)
View(data_gfed_n2o)
