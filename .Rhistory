## calculate total GHGs
data_table_ghgs <- rbind(data_table_ghgs,data_ghg %>%
filter(year==2022) %>%
mutate(cut="2022"))
data_table_ghgs <- rbind(data_table_ghgs,data_table_ghgs %>%
filter(year>=2010) %>%
filter(year<=2019) %>%
mutate(cut="2010-2019")) %>%
filter(!is.na(cut))
data_table_ghgs <- left_join(data_table_ghgs,uncertainties,by="label")
data_table_ghgs <- data_table_ghgs %>%
group_by(cut,label,uncertainty) %>%
summarise(value=mean(value,na.rm=TRUE))
data_table_ghgs <- data_table_ghgs %>%
mutate(uncertainty_abs=value*uncertainty) %>%
mutate(uncertainty_abs=uncertainty_abs^2) %>%
filter(!is.na(cut)) %>%
group_by(cut) %>%
summarise(value=sum(value,na.rm=TRUE),
uncertainty_abs=sqrt(sum(uncertainty_abs,na.rm=TRUE)))
data_table_ghgs <- data_table_ghgs %>%
mutate(label="GHG") %>%
mutate(value=signif(value,2)) %>%
mutate(uncertainty_abs=signif(uncertainty_abs,2)) %>%
mutate(value=paste0(value,"±",uncertainty_abs))
data_table <- rbind(data_table,data_table_ghgs)
data_table <- data_table %>%
select(-uncertainty,-uncertainty_abs)
## add GCB 2022 projections
data_table <- data_table %>%
ungroup() %>%
add_row(label="CO2-FFI",cut="2023 (projection)",value="37±2.9") %>%
add_row(label="CO2-LULUCF",cut="2023 (projection)",value="4±2.8")
# round(10*(44/12),0)
# (10*(44/12))*0.08
#
# round(1.1*(44/12))
# (1.1*(44/12))*0.7
data_table$label <- as.factor(data_table$label)
data_table$label <- fct_relevel(data_table$label,"GHG","CO2-FFI","CO2-LULUCF","CH4","N2O","F-gases")
data_table <- spread(data_table,cut,value)
write.xlsx(data_table,'results/section_2_2_table_2024.xlsx')
write.csv(data_table,'results/section_2_2_table_2024.csv',row.names = FALSE)
write.csv(spread(data_ghg %>%
ungroup() %>%
select(-var,-source),label,value),'results/ghg_emissions_co2e_2024.csv',row.names = FALSE)
metadata <- data_ghg %>%
filter(year==2020) %>%
select(gas=label,source,units_co2e=units) %>%
mutate(units_original=ifelse(source!="PRIMAP v2.4.2*",units_co2e,"MtCH4")) %>%
mutate(units_original=ifelse(gas=="N2O","MtN2O",units_original))
metadata$source <- gsub("\\*","",metadata$source)
wb <- createWorkbook()
addWorksheet(wb,"metadata")
addWorksheet(wb,"data_co2e")
writeData(wb,"metadata",metadata, colNames = T, rowNames = F)
writeData(wb,"data_co2e",spread(data_ghg %>% ungroup %>% select(-var,-source,-units),label,value), colNames = T, rowNames = F)
### add a sheet with the data in original units
data_ghg_original <- rbind(data_gcb_co2_ffi,data_gcb_co2_luc %>% filter(source=="GCB v2022*"))
data_ghg_original <- rbind(data_ghg_original,data_primap_cr_ch4)
data_ghg_original <- rbind(data_ghg_original,data_primap_cr_n2o)
data_ghg_original <- rbind(data_ghg_original,data_fgases %>% filter(grepl("UNFCCC",source)))
# 1970s
# 1980s
# 1990s
# 2000s
# 2010s
# 2022
# 2023
data_table <- data_ghg %>%
mutate(cut=ifelse(year>=1970 & year <=1979,"1970-1979",NA)) %>%
mutate(cut=ifelse(year>=1980 & year <=1989,"1980-1989",cut)) %>%
mutate(cut=ifelse(year>=1990 & year <=1999,"1990-1999",cut)) %>%
mutate(cut=ifelse(year>=2000 & year <=2009,"2000-2009",cut)) %>%
mutate(cut=ifelse(year>=2013 & year <=2022,"2013-2022",cut))
data_table_ghgs <- data_table
data_table <- data_table %>%
filter(!is.na(cut)) %>%
group_by(label,cut) %>%
summarise(value=mean(value))
## add a 2010-2019 column
data_table_2010 <- data_ghg %>%
mutate(cut=ifelse(year>=2010 & year <=2019,"2010-2019",NA)) %>%
filter(!is.na(cut)) %>%
group_by(label,cut) %>%
summarise(value=mean(value))
data_table <- rbind(data_table,data_table_2010)
## add the 2022 data
data_table <- rbind(data_table,data_ghg %>%
ungroup() %>%
filter(year==2022) %>%
rename(cut=year) %>%
mutate(cut=as.character(cut)) %>%
select(label,cut,value))
## calculate uncertainties
uncertainties = data.frame(label=c("CO2-FFI","CO2-LULUCF","CH4","N2O","F-gases"),uncertainty=c(0.08,0.7,0.3,0.6,0.3))
data_table <- left_join(data_table,uncertainties,by="label")
data_table <- data_table %>%
mutate(uncertainty_abs=value*uncertainty) %>%
mutate(value=signif(value,2)) %>%
mutate(uncertainty_abs=signif(uncertainty_abs,2))
data_table <- data_table %>%
mutate(value=paste0(value,"±",uncertainty_abs))
## calculate total GHGs
data_table_ghgs <- rbind(data_table_ghgs,data_ghg %>%
filter(year==2022) %>%
mutate(cut="2022"))
data_table_ghgs <- rbind(data_table_ghgs,data_table_ghgs %>%
filter(year>=2010) %>%
filter(year<=2019) %>%
mutate(cut="2010-2019")) %>%
filter(!is.na(cut))
data_table_ghgs <- left_join(data_table_ghgs,uncertainties,by="label")
data_table_ghgs <- data_table_ghgs %>%
group_by(cut,label,uncertainty) %>%
summarise(value=mean(value,na.rm=TRUE))
data_table_ghgs <- data_table_ghgs %>%
mutate(uncertainty_abs=value*uncertainty) %>%
mutate(uncertainty_abs=uncertainty_abs^2) %>%
filter(!is.na(cut)) %>%
group_by(cut) %>%
summarise(value=sum(value,na.rm=TRUE),
uncertainty_abs=sqrt(sum(uncertainty_abs,na.rm=TRUE)))
data_table_ghgs <- data_table_ghgs %>%
mutate(label="GHG") %>%
mutate(value=signif(value,2)) %>%
mutate(uncertainty_abs=signif(uncertainty_abs,2)) %>%
mutate(value=paste0(value,"±",uncertainty_abs))
data_table <- rbind(data_table,data_table_ghgs)
data_table <- data_table %>%
select(-uncertainty,-uncertainty_abs)
## add GCB 2022 projections
data_table <- data_table %>%
ungroup() %>%
add_row(label="CO2-FFI",cut="2023 (projection)",value="37±2.9") %>%
add_row(label="CO2-LULUCF",cut="2023 (projection)",value="4±2.8")
# round(10*(44/12),0)
# (10*(44/12))*0.08
#
# round(1.1*(44/12))
# (1.1*(44/12))*0.7
data_table$label <- as.factor(data_table$label)
data_table$label <- fct_relevel(data_table$label,"GHG","CO2-FFI","CO2-LULUCF","CH4","N2O","F-gases")
data_table <- spread(data_table,cut,value)
write.xlsx(data_table,'results/section_2_2_table_2024.xlsx')
write.csv(data_table,'results/section_2_2_table_2024.csv',row.names = FALSE)
write.csv(spread(data_ghg %>%
ungroup() %>%
select(-var,-source),label,value),'results/ghg_emissions_co2e_2024.csv',row.names = FALSE)
metadata <- data_ghg %>%
filter(year==2020) %>%
select(gas=label,source,units_co2e=units) %>%
mutate(units_original=ifelse(source!="PRIMAP v2.4.2*",units_co2e,"MtCH4")) %>%
mutate(units_original=ifelse(gas=="N2O","MtN2O",units_original))
metadata$source <- gsub("\\*","",metadata$source)
wb <- createWorkbook()
addWorksheet(wb,"metadata")
addWorksheet(wb,"data_co2e")
writeData(wb,"metadata",metadata, colNames = T, rowNames = F)
writeData(wb,"data_co2e",spread(data_ghg %>% ungroup %>% select(-var,-source,-units),label,value), colNames = T, rowNames = F)
### add a sheet with the data in original units
data_ghg_original <- rbind(data_gcb_co2_ffi,data_gcb_co2_luc %>% filter(source=="GCB v2022*"))
data_ghg_original <- rbind(data_ghg_original,data_primap_cr_ch4)
data_ghg_original <- rbind(data_ghg_original,data_primap_cr_n2o)
data_ghg_original <- rbind(data_ghg_original,data_inversions_fgases %>% filter(grepl("UNFCCC",source)))
data_ghg_original <- rbind(data_ghg_original,data_gfed_ch4)
data_ghg_original <- rbind(data_ghg_original,data_gfed_n2o)
data_ghg_original <- left_join(data_ghg_original,data_ghg %>% ungroup() %>% select(var,label) %>% distinct(),by="var")
data_ghg_original <- data_ghg_original %>%
select(label,source,units,year,value)
addWorksheet(wb,"data_original_units")
writeData(wb,"data_original_units",data_ghg_original, colNames = T, rowNames = F)
## add a sheet with all the other sources
# addWorksheet(wb,"data_all_sources")
# writeData(wb,"data_all_sources",left_join(data,data_ghg %>% select(var,label) %>% distinct(),by="var") %>%
#   select(year,gas=label,source,units,value), colNames = T, rowNames = F)
saveWorkbook(wb,'results/ghg_emissions_co2e_2024.xlsx',overwrite=T)
data_2024 <- data
data_ghg_2024 <- data_ghg
save(data_2024,data_ghg_2024,file="results/data/data_2024.RData")
data_smith_hall <- read.csv("sources/smith-hall-inversions-1750-2023.csv") %>%
filter(Variable %in% c("Emissions|CH4","Emissions|N2O"))
data_smith_hall <- gather(data_smith_hall,year,value,X1750:X2023)
data_smith_hall$year <- gsub("X","",data_smith_hall$year)
data_smith_hall$year <- as.numeric(data_smith_hall$year)
data_smith_hall <- data_smith_hall %>%
mutate(var=ifelse(Variable=="Emissions|CH4","ch4","n2o")) %>%
select(year,var,value_smith=value)
data_test <- data %>%
filter(var %in% c("ch4","n2o")) %>%
filter(source %in% c("PRIMAP TP v2.5.1","GFED v4.1*")) %>%
group_by(year,var) %>%
summarise(value=sum(value))
data_test <- left_join(data_test,data_smith_hall)
View(data_test)
# AR6: 59 ± 6.6 GtCO2e in 2019, 56 ± 6.0 GtCO2e from 2010-2019
load("sources/IPCC AR6 WG3 data/data_land_co2.RData")
load("sources/IPCC AR6 WG3 data/data_edgar_ghg.RData")
data_ar6 <- edgar_ghg %>%
group_by(year) %>%
summarise_at(vars(CO2,CH4,N2O,Fgas),sum,na.rm=TRUE)
data_ar6 <- left_join(data_ar6,land %>%
filter(year>=1970) %>%
group_by(year) %>%
summarise(`CO2-LUC`=sum(mean,na.rm=TRUE)))
data_ar6  <- gather(data_ar6,label,value_ar6,-year) %>%
mutate(value_ar6=value_ar6/1e9) %>%
mutate(label=ifelse(label=="CO2","CO2-FFI",label)) %>%
mutate(label=ifelse(label=="Fgas","F-gases",label)) %>%
mutate(label=ifelse(label=="CO2-LUC","CO2-LULUCF",label))
### 2019
data_comparison <- left_join(data_ghg,data_ar6) %>%
filter(year==2019)
data_comparison <- left_join(data_comparison,uncertainties,by="label")
data_comparison <- data_comparison %>%
mutate(difference=value-value_ar6)
#
# data_comparison <- data_comparison %>%
#   filter(var!="co2_luc") %>%
#   filter(var!="ch4")
# sum(data_comparison$difference)
data_comparison <- data_comparison %>%
mutate(uncertainty_abs=value*uncertainty) %>%
mutate(uncertainty_abs=uncertainty_abs^2) %>%
group_by(year) %>%
summarise(value=sum(value,na.rm=TRUE),
uncertainty_abs=sqrt(sum(uncertainty_abs,na.rm=TRUE)))
### 2010-2019
data_comparison <- data_ghg %>%
filter(year>=2010) %>%
filter(year<=2019) %>%
group_by(label) %>%
summarise(value=mean(value))
data_comparison <- left_join(data_comparison,data_ar6 %>%
filter(year>=2010) %>%
filter(year<=2019) %>%
group_by(label) %>%
summarise(value_ar6=mean(value_ar6)),by="label")
sum(data_comparison$value)-sum(data_comparison$value_ar6)
data_comparison <- left_join(data_comparison,uncertainties,by="label")
data_comparison <- data_comparison %>%
mutate(uncertainty_abs=value*uncertainty) %>%
mutate(uncertainty_abs=uncertainty_abs^2) %>%
mutate(year="2010-2019") %>%
group_by(year) %>%
summarise(value=sum(value,na.rm=TRUE),
uncertainty_abs=sqrt(sum(uncertainty_abs,na.rm=TRUE)))
#### inversion data from Deng et al. 2022
data_deng_ch4 <- read.csv("sources/Deng_CH4_inversion_2000-2017.csv")
data_deng_ch4 <- data_deng_ch4  %>%
filter(Sector=="anthropogenic (method 1)") %>%
select(iso,year=Year,`GOSAT inversions (median and range)`=GOSAT_med,`In-situ inversions (median and range)`=SURF_med,GOSAT_min,GOSAT_max,SURF_min,SURF_max) %>%
mutate(iso=ifelse(iso=="EUA","EUR",iso))
#### national CH4 data from sources in this assessment
data_ceds_ch4 <- read.csv("sources/CEDS v2024.04.01/CH4_CEDS_emissions_by_country_v2024_04_01.csv")
data_ceds_ch4 <- gather(data_ceds_ch4,year,value,X1970:X2022)
data_ceds_ch4$year <- gsub("X","",data_ceds_ch4$year)
data_ceds_ch4 <- data_ceds_ch4 %>%
select(iso=country,gas=em,year,value) %>%
mutate(iso=countrycode(iso,"iso3c","iso3c")) %>%
mutate(value=value/1000) %>%
mutate(year=as.numeric(year))
data_edgar_ch4 <- read.xlsx("sources/EDGAR/EDGAR_CH4_1970_2022.xlsx",sheet=2,startRow = 10)
data_edgar_ch4 <- gather(data_edgar_ch4,year,value,Y_1970:Y_2022)
data_edgar_ch4$year <- gsub("Y_","",data_edgar_ch4$year)
data_edgar_ch4 <- data_edgar_ch4 %>%
select(iso=Country_code_A3,country=Name,code=ipcc_code_2006_for_standard_report,code_name=ipcc_code_2006_for_standard_report_name,gas=Substance,fossil_bio,year,value) %>%
group_by(iso,year) %>%
summarise(value=sum(value,na.rm=TRUE)/1000) %>%
mutate(year=as.numeric(year))
data_primap_ch4 <- read.csv("sources/PRIMAP/Guetschow_et_al_2024-PRIMAP-hist_v2.5.1_final_27-Feb-2024.csv")
data_primap_ch4 <- gather(data_primap_ch4,year,value,X1750:X2022)
data_primap_ch4$year <- gsub("X","",data_primap_ch4$year)
names(data_primap_ch4) <- c("source","scenario","provenance","area","gas","unit","category","year","value")
data_primap_ch4 <- data_primap_ch4 %>%
filter(category=="M.0.EL") %>%
filter(gas=="CH4") %>%
mutate(value=value/1000) %>%
mutate(source=ifelse(scenario=="HISTCR","PRIMAP CR v2.5.1*","PRIMAP TP v2.5.1")) %>%
select(iso=area,year,source,value) %>%
mutate(year=as.numeric(year))
#### merge EU27+UK
country_aggregations <- read.csv("https://raw.githubusercontent.com/openclimatedata/countrygroups/main/data/european-union.csv") %>%
select(iso=Code) %>%
mutate(EU="EUR") %>%
add_row(iso="GBR",EU="EUR")
data_ceds_ch4 <- left_join(data_ceds_ch4,country_aggregations)
data_ceds_ch4 <- data_ceds_ch4 %>%
mutate(iso=ifelse(!is.na(EU),EU,iso)) %>%
group_by(iso,year) %>%
summarise(value=sum(value,na.rm=TRUE)) %>%
rename(`CEDS v2024.4.1`=value)
data_edgar_ch4 <- left_join(data_edgar_ch4,country_aggregations)
data_edgar_ch4 <- data_edgar_ch4 %>%
mutate(iso=ifelse(!is.na(EU),EU,iso)) %>%
group_by(iso,year) %>%
summarise(value=sum(value,na.rm=TRUE)) %>%
rename(`EDGARv8`=value)
data_primap_ch4 <- left_join(data_primap_ch4,country_aggregations)
data_primap_ch4 <- data_primap_ch4 %>%
mutate(iso=ifelse(!is.na(EU),EU,iso)) %>%
group_by(iso,source,year) %>%
summarise(value=sum(value,na.rm=T))
data_primap_ch4 <- spread(data_primap_ch4,source,value)
#### join and compare
data_comparison <- left_join(data_deng_ch4,data_ceds_ch4,by = join_by(iso, year))
data_comparison <- left_join(data_comparison,data_edgar_ch4,by = join_by(iso, year))
data_comparison <- left_join(data_comparison,data_primap_ch4,by = join_by(iso, year))
data_comparison <- gather(data_comparison,dataset,value,-iso,-year)
data_comparison <- data_comparison %>%
filter(year>=2010) %>%
filter(year<=2017) %>%
group_by(iso,dataset) %>%
summarise(value=mean(value))
data_comparison_order <- data_comparison %>%
group_by(iso) %>%
summarise(value=mean(value,na.rm=T)) %>%
arrange(desc(value)) %>%
mutate(order=1) %>%
mutate(order=cumsum(order)) %>%
mutate(cut=cut(value,breaks=3,labels=c("low","med","high"))) %>%
select(iso,order,cut)
data_comparison <- left_join(data_comparison,data_comparison_order,by = join_by(iso))
data_comparison <- data_comparison %>%
mutate(country=countrycode(iso,"iso3c","country.name")) %>%
mutate(country=ifelse(iso=="EUR","EU27+UK",country)) %>%
mutate(country=ifelse(country=="United Arab Emirates","UAE",country)) %>%
mutate(country=as.factor(country))
data_comparison$country <- fct_reorder(data_comparison$country,data_comparison$order)
data_comparison$dataset <- as.factor(data_comparison$dataset)
data_comparison$dataset <- fct_relevel(data_comparison$dataset,"GOSAT inversions (median and range)","In-situ inversions (median and range)")
p1 <- ggplot(data_comparison,aes(y=value,x=country,shape=dataset,color=dataset,group=dataset)) +
geom_point(data=data_comparison %>%
filter(cut=="high") %>%
filter(dataset=="GOSAT inversions (median and range)"),size=2,position=position_nudge(x=-0.2)) +
geom_point(data=data_comparison %>%
filter(cut=="high") %>%
filter(dataset=="In-situ inversions (median and range)"),size=2,position=position_nudge(x=-0.1)) +
geom_point(data=data_comparison %>%
filter(cut=="high") %>%
filter(!grepl("median",dataset)) %>%
filter(!grepl("min",dataset)) %>%
filter(!grepl("max",dataset)),size=2,position=position_nudge(x=0.1)) +
geom_path(data=data_comparison %>%
filter(cut=="high") %>%
filter(dataset %in% c("GOSAT_min","GOSAT_max")),
inherit.aes=FALSE,
aes(y=value,x=country,group=country),
size=1.5,alpha=0.25,color="#1b9e77",show.legend=FALSE,position=position_nudge(x=-0.2)) +
geom_path(data=data_comparison %>%
filter(cut=="high") %>%
filter(dataset %in% c("SURF_min","SURF_max")),
inherit.aes=FALSE,
aes(y=value,x=country,group=country),
size=1.5,alpha=0.25,color="#d95f02",show.legend=FALSE,position=position_nudge(x=-0.1)) +
theme_wl() +
scale_color_brewer(palette="Dark2") +
theme(axis.text.x=element_text(angle=45,hjust=1,vjust=1),
legend.position="bottom",
legend.title=element_blank(),
axis.title = element_blank(),
legend.background = element_blank(),
title = element_text(size=10)) +
labs(title="Total anthropogenic CH4 emissions by country and dataset",
subtitle=bquote("Mt" ~CH[4]* "/year (2010-2017 average)"))
p2 <- ggplot(data_comparison,aes(y=value,x=country,shape=dataset,color=dataset,group=dataset)) +
geom_point(data=data_comparison %>%
filter(cut=="med") %>%
filter(dataset=="GOSAT inversions (median and range)"),size=2,position=position_nudge(x=-0.2)) +
geom_point(data=data_comparison %>%
filter(cut=="med") %>%
filter(dataset=="In-situ inversions (median and range)"),size=2,position=position_nudge(x=-0.1)) +
geom_point(data=data_comparison %>%
filter(cut=="med") %>%
filter(!grepl("median",dataset)) %>%
filter(!grepl("min",dataset)) %>%
filter(!grepl("max",dataset)),size=2,position=position_nudge(x=0.1)) +
geom_path(data=data_comparison %>%
filter(cut=="med") %>%
filter(dataset %in% c("GOSAT_min","GOSAT_max")),
inherit.aes=FALSE,
aes(y=value,x=country,group=country),
size=1.5,alpha=0.25,color="#1b9e77",show.legend=FALSE,position=position_nudge(x=-0.2)) +
geom_path(data=data_comparison %>%
filter(cut=="med") %>%
filter(dataset %in% c("SURF_min","SURF_max")),
inherit.aes=FALSE,
aes(y=value,x=country,group=country),
size=1.5,alpha=0.25,color="#d95f02",show.legend=FALSE,position=position_nudge(x=-0.1)) +
theme_wl() +
scale_color_brewer(palette="Dark2") +
theme(axis.text.x=element_text(angle=45,hjust=1,vjust=1),
legend.position="bottom",
legend.title=element_blank(),
legend.background = element_blank(),
axis.title = element_blank(),
plot.background = element_blank())
p3 <- ggplot(data_comparison,aes(y=value,x=country,shape=dataset,color=dataset,group=dataset)) +
geom_point(data=data_comparison %>%
filter(cut=="low") %>%
filter(dataset=="GOSAT inversions (median and range)"),size=2,position=position_nudge(x=-0.2)) +
geom_point(data=data_comparison %>%
filter(cut=="low") %>%
filter(dataset=="In-situ inversions (median and range)"),size=2,position=position_nudge(x=-0.1)) +
geom_point(data=data_comparison %>%
filter(cut=="low") %>%
filter(!grepl("median",dataset)) %>%
filter(!grepl("min",dataset)) %>%
filter(!grepl("max",dataset)),size=2,position=position_nudge(x=0.1)) +
geom_path(data=data_comparison %>%
filter(cut=="low") %>%
filter(dataset %in% c("GOSAT_min","GOSAT_max")),
inherit.aes=FALSE,
aes(y=value,x=country,group=country),
size=1.5,alpha=0.25,color="#1b9e77",show.legend=FALSE,position=position_nudge(x=-0.2)) +
geom_path(data=data_comparison %>%
filter(cut=="low") %>%
filter(dataset %in% c("SURF_min","SURF_max")),
inherit.aes=FALSE,
aes(y=value,x=country,group=country),
size=1.5,alpha=0.25,color="#d95f02",show.legend=FALSE,position=position_nudge(x=-0.1)) +
theme_wl() +
scale_color_brewer(palette="Dark2") +
theme(axis.text.x=element_text(angle=45,hjust=1,vjust=1),
legend.position="bottom",
legend.title=element_blank(),
legend.background = element_blank(),
axis.title = element_blank(),
plot.background = element_blank())
((p1 + p2 + p3 + plot_layout(widths=c(1,5,18))) / guide_area())  + plot_layout(guides="collect",heights=c(5,1))
load("sources/IPCC AR6 WG3 data/data_land_co2.RData")
load("sources/IPCC AR6 WG3 data/data_edgar_ghg.RData")
data_ar6 <- edgar_ghg %>%
group_by(year) %>%
summarise_at(vars(CO2,CH4,N2O,Fgas),sum,na.rm=TRUE)
data_ar6 <- left_join(data_ar6,land %>%
filter(year>=1970) %>%
group_by(year) %>%
summarise(`CO2-LUC`=sum(mean,na.rm=TRUE)))
data_ar6  <- gather(data_ar6,label,value_ar6,-year) %>%
mutate(value_ar6=value_ar6/1e9) %>%
mutate(label=ifelse(label=="CO2","CO2-FFI",label)) %>%
mutate(label=ifelse(label=="Fgas","F-gases",label)) %>%
mutate(label=ifelse(label=="CO2-LUC","CO2-LULUCF",label))
### 2019
data_comparison <- left_join(data_ghg,data_ar6) %>%
filter(year==2019)
data_comparison <- left_join(data_comparison,uncertainties,by="label")
data_comparison <- data_comparison %>%
mutate(difference=value-value_ar6)
#
# data_comparison <- data_comparison %>%
#   filter(var!="co2_luc") %>%
#   filter(var!="ch4")
# sum(data_comparison$difference)
data_comparison <- data_comparison %>%
mutate(uncertainty_abs=value*uncertainty) %>%
mutate(uncertainty_abs=uncertainty_abs^2) %>%
group_by(year) %>%
summarise(value=sum(value,na.rm=TRUE),
uncertainty_abs=sqrt(sum(uncertainty_abs,na.rm=TRUE)))
View(data_comparison)
data_comparison <- data_ghg %>%
filter(year>=2010) %>%
filter(year<=2019) %>%
group_by(label) %>%
summarise(value=mean(value))
data_comparison <- left_join(data_comparison,data_ar6 %>%
filter(year>=2010) %>%
filter(year<=2019) %>%
group_by(label) %>%
summarise(value_ar6=mean(value_ar6)),by="label")
sum(data_comparison$value)-sum(data_comparison$value_ar6)
data_comparison <- left_join(data_comparison,uncertainties,by="label")
data_comparison <- data_comparison %>%
mutate(uncertainty_abs=value*uncertainty) %>%
mutate(uncertainty_abs=uncertainty_abs^2) %>%
mutate(year="2010-2019") %>%
group_by(year) %>%
summarise(value=sum(value,na.rm=TRUE),
uncertainty_abs=sqrt(sum(uncertainty_abs,na.rm=TRUE)))
load("sources/IPCC AR6 WG3 data/data_land_co2.RData")
load("sources/IPCC AR6 WG3 data/data_edgar_ghg.RData")
data_ar6 <- edgar_ghg %>%
group_by(year) %>%
summarise_at(vars(CO2,CH4,N2O,Fgas),sum,na.rm=TRUE)
data_ar6 <- left_join(data_ar6,land %>%
filter(year>=1970) %>%
group_by(year) %>%
summarise(`CO2-LUC`=sum(mean,na.rm=TRUE)))
data_ar6  <- gather(data_ar6,label,value_ar6,-year) %>%
mutate(value_ar6=value_ar6/1e9) %>%
mutate(label=ifelse(label=="CO2","CO2-FFI",label)) %>%
mutate(label=ifelse(label=="Fgas","F-gases",label)) %>%
mutate(label=ifelse(label=="CO2-LUC","CO2-LULUCF",label))
data_comparison <- left_join(data_ghg,data_ar6) %>%
filter(year==2019)
data_comparison <- left_join(data_comparison,uncertainties,by="label")
data_comparison <- data_comparison %>%
mutate(difference=value-value_ar6)
data_comparison <- data_comparison %>%
filter(var!="co2_luc") %>%
filter(var!="ch4")
sum(data_comparison$difference)
blarg <- data_primap %>% select(category) %>% distinct()
View(blarg)
data_primap <- read.csv("sources/PRIMAP/Guetschow_et_al_2024-PRIMAP-hist_v2.5.1_final_27-Feb-2024.csv")
data_primap <- gather(data_primap,year,value,X1750:X2022)
data_primap$year <- gsub("X","",data_primap$year)
names(data_primap) <- c("source","scenario","provenance","area","gas","unit","category","year","value")
blarg <- data_primap %>% select(category) %>% distinct()
View(blarg)
